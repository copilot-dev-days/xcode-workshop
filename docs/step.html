<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Copilot for Xcode Workshop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-code: #1a1a2e;
            --neon-cyan: #00f5ff;
            --neon-magenta: #ff00ff;
            --neon-purple: #b366ff;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --border-color: #2a2a3a;
            --success-green: #00ff88;
            --warning-yellow: #ffcc00;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Space Grotesk', sans-serif; background: var(--bg-dark); color: var(--text-primary); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(0,245,255,0.03) 1px, transparent 1px), linear-gradient(rgba(0,245,255,0.03) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: -1; }

        /* Header */
        .header { position: sticky; top: 0; z-index: 100; background: rgba(10,10,15,0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 0.75rem 1.5rem; display: flex; align-items: center; justify-content: space-between; }
        .header-brand { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; color: var(--text-primary); font-weight: 700; font-size: 1.1rem; }
        .header-brand:hover { color: var(--neon-cyan); }
        .header-nav { display: flex; gap: 0.5rem; }
        .header-nav button { background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 0.875rem; transition: all 0.3s ease; }
        .header-nav button:hover:not(:disabled) { border-color: var(--neon-cyan); color: var(--neon-cyan); }
        .header-nav button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* Layout */
        .layout { display: flex; flex: 1; }

        /* Sidebar */
        .sidebar { width: 280px; background: var(--bg-card); border-right: 1px solid var(--border-color); padding: 1.5rem 0; overflow-y: auto; position: sticky; top: 52px; height: calc(100vh - 52px); flex-shrink: 0; }
        .sidebar-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-secondary); padding: 0 1.5rem; margin-bottom: 1rem; }
        .sidebar-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem; text-decoration: none; color: var(--text-secondary); transition: all 0.2s ease; cursor: pointer; border-left: 3px solid transparent; }
        .sidebar-item:hover { background: rgba(0,245,255,0.05); color: var(--text-primary); }
        .sidebar-item.active { color: var(--neon-cyan); border-left-color: var(--neon-cyan); background: rgba(0,245,255,0.08); }
        .sidebar-item-number { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.85rem; flex-shrink: 0; }
        .sidebar-item-title { font-size: 0.9rem; }

        /* Main Content */
        .main { flex: 1; min-width: 0; }
        .content { max-width: 860px; margin: 0 auto; padding: 3rem 2rem; }

        /* Loading */
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--border-color); border-top-color: var(--neon-cyan); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 1rem; color: var(--text-secondary); }

        /* Markdown Content */
        .markdown-body { font-size: 1.05rem; line-height: 1.8; }
        .markdown-body h1 { font-size: 2.25rem; font-weight: 700; margin: 2rem 0 1rem; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .markdown-body h2 { font-size: 1.75rem; font-weight: 600; margin: 2.5rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color); color: var(--neon-cyan); }
        .markdown-body h3 { font-size: 1.35rem; font-weight: 600; margin: 2rem 0 0.75rem; color: var(--neon-purple); }
        .markdown-body h4 { font-size: 1.15rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }
        .markdown-body p { margin-bottom: 1rem; color: var(--text-secondary); }
        .markdown-body a { color: var(--neon-cyan); text-decoration: none; border-bottom: 1px solid transparent; transition: border-color 0.3s ease; }
        .markdown-body a:hover { border-bottom-color: var(--neon-cyan); }
        .markdown-body strong { color: var(--text-primary); }
        .markdown-body ul, .markdown-body ol { margin-bottom: 1rem; padding-left: 1.5rem; color: var(--text-secondary); }
        .markdown-body li { margin-bottom: 0.5rem; }
        .markdown-body li::marker { color: var(--neon-cyan); }
        .markdown-body code { font-family: 'JetBrains Mono', monospace; background: var(--bg-code); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.9em; color: var(--neon-magenta); }
        .markdown-body pre { background: var(--bg-code); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.25rem; overflow-x: auto; margin-bottom: 1.5rem; }
        .markdown-body pre code { background: none; padding: 0; color: var(--text-primary); font-size: 0.875rem; line-height: 1.7; }
        .markdown-body blockquote { border-left: 4px solid var(--neon-purple); padding: 1rem 1.5rem; margin-bottom: 1.5rem; background: rgba(179,102,255,0.05); border-radius: 0 8px 8px 0; }
        .markdown-body blockquote p { color: var(--text-secondary); margin-bottom: 0; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
        .markdown-body th, .markdown-body td { padding: 0.75rem 1rem; border: 1px solid var(--border-color); text-align: left; }
        .markdown-body th { background: var(--bg-code); color: var(--neon-cyan); font-weight: 600; }
        .markdown-body td { color: var(--text-secondary); }
        .markdown-body tr:hover td { background: rgba(0,245,255,0.03); }
        .markdown-body img { max-width: 100%; border-radius: 8px; margin: 1rem 0; border: 1px solid var(--border-color); }
        .markdown-body hr { border: none; border-top: 1px solid var(--border-color); margin: 2rem 0; }
        .markdown-body input[type="checkbox"] { appearance: none; -webkit-appearance: none; width: 18px; height: 18px; border: 2px solid var(--border-color); border-radius: 4px; vertical-align: middle; margin-right: 0.5rem; position: relative; cursor: default; }
        .markdown-body input[type="checkbox"]:checked { background: var(--neon-cyan); border-color: var(--neon-cyan); }
        .markdown-body input[type="checkbox"]:checked::after { content: '‚úì'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--bg-dark); font-size: 12px; font-weight: 700; }

        /* GitHub Alerts */
        .alert { border-radius: 8px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; border-left: 4px solid; }
        .alert-title { font-weight: 600; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem; }
        .alert p { margin-bottom: 0; }
        .alert-note { background: rgba(0,245,255,0.05); border-color: var(--neon-cyan); }
        .alert-note .alert-title { color: var(--neon-cyan); }
        .alert-tip { background: rgba(0,255,136,0.05); border-color: var(--success-green); }
        .alert-tip .alert-title { color: var(--success-green); }
        .alert-important { background: rgba(179,102,255,0.05); border-color: var(--neon-purple); }
        .alert-important .alert-title { color: var(--neon-purple); }
        .alert-warning { background: rgba(255,204,0,0.05); border-color: var(--warning-yellow); }
        .alert-warning .alert-title { color: var(--warning-yellow); }
        .alert-caution { background: rgba(255,0,100,0.05); border-color: #ff0064; }
        .alert-caution .alert-title { color: #ff0064; }

        /* Footer Nav */
        .footer-nav { display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .footer-nav a { display: flex; flex-direction: column; text-decoration: none; padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color); transition: all 0.3s ease; max-width: 45%; }
        .footer-nav a:hover { border-color: var(--neon-cyan); background: rgba(0,245,255,0.05); }
        .footer-nav-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem; }
        .footer-nav-title { color: var(--neon-cyan); font-weight: 600; }
        .footer-nav-next { text-align: right; margin-left: auto; }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .content { padding: 2rem 1rem; }
            .footer-nav { flex-direction: column; gap: 1rem; }
            .footer-nav a { max-width: 100%; }
            .footer-nav-next { text-align: left; margin-left: 0; }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="header-brand">üçé Copilot for Xcode Workshop</a>
        <div class="header-nav">
            <button id="prev-btn" onclick="navigateStep(-1)" disabled>‚Üê Prev</button>
            <button id="next-btn" onclick="navigateStep(1)" disabled>Next ‚Üí</button>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-title">Workshop Steps</div>
            <div id="sidebar-nav"></div>
        </aside>

        <main class="main">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading content...</div>
            </div>
            <div id="content" class="content" style="display:none;">
                <div id="markdown-content" class="markdown-body"></div>
                <div id="footer-nav" class="footer-nav"></div>
            </div>
        </main>
    </div>

    <script>
        const steps = [
            { id: 'guide', file: 'GUIDE.md', title: 'Quick Reference', number: 'üìö' },
            { id: '00-overview', file: '00-overview.md', title: 'Overview & Checklist', number: '00' },
            { id: '01-setup', file: '01-setup.md', title: 'Prerequisites & Setup', number: '01' },
            { id: '02-chat', file: '02-chat.md', title: 'Copilot Chat', number: '02' },
            { id: '03-completion', file: '03-completion.md', title: 'Code Completion', number: '03' },
            { id: '04-agent-mode', file: '04-agent-mode.md', title: 'Agent Mode', number: '04' },
            { id: '05-plan-agent', file: '05-plan-agent.md', title: 'Plan Agent', number: '05' },
            { id: '06-mcp', file: '06-mcp.md', title: 'MCP Server', number: '06' },
            { id: '07-vision', file: '07-vision.md', title: 'Copilot Vision', number: '07' },
            { id: '08-tips-and-resources', file: '08-tips-and-resources.md', title: 'Tips & Resources', number: 'üéâ' },
        ];

        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:';
        const GITHUB_RAW_BASE = isLocal ? '../.lab/' : 'https://raw.githubusercontent.com/copilot-dev-days/xcode-workshop/main/.lab/';

        let currentStepIndex = 0;

        function getStepFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('step') || '00-overview';
        }

        function buildSidebar() {
            const nav = document.getElementById('sidebar-nav');
            nav.innerHTML = steps.map((step, i) => `
                <a class="sidebar-item ${i === currentStepIndex ? 'active' : ''}"
                   href="?step=${step.id}" onclick="event.preventDefault(); goToStep(${i});">
                    <span class="sidebar-item-number">${step.number}</span>
                    <span class="sidebar-item-title">${step.title}</span>
                </a>
            `).join('');
        }

        function updateNavButtons() {
            document.getElementById('prev-btn').disabled = currentStepIndex <= 0;
            document.getElementById('next-btn').disabled = currentStepIndex >= steps.length - 1;
        }

        function buildFooterNav() {
            const nav = document.getElementById('footer-nav');
            let html = '';
            if (currentStepIndex > 0) {
                const prev = steps[currentStepIndex - 1];
                html += `<a href="?step=${prev.id}" onclick="event.preventDefault(); goToStep(${currentStepIndex - 1});">
                    <span class="footer-nav-label">‚Üê Previous</span>
                    <span class="footer-nav-title">${prev.title}</span>
                </a>`;
            }
            if (currentStepIndex < steps.length - 1) {
                const next = steps[currentStepIndex + 1];
                html += `<a class="footer-nav-next" href="?step=${next.id}" onclick="event.preventDefault(); goToStep(${currentStepIndex + 1});">
                    <span class="footer-nav-label">Next ‚Üí</span>
                    <span class="footer-nav-title">${next.title}</span>
                </a>`;
            }
            nav.innerHTML = html;
        }

        function processMarkdown(md) {
            // Convert GitHub alerts
            md = md.replace(/^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*\n((?:> .*(?:\n|$))*)/gim, (match, type, body) => {
                const cleanBody = body.replace(/^> ?/gm, '').trim();
                const icons = { NOTE: '‚ÑπÔ∏è', TIP: 'üí°', IMPORTANT: '‚ùó', WARNING: '‚ö†Ô∏è', CAUTION: 'üî¥' };
                return `<div class="alert alert-${type.toLowerCase()}">
                    <div class="alert-title">${icons[type.toUpperCase()] || ''} ${type.charAt(0).toUpperCase() + type.slice(1).toLowerCase()}</div>
                    <p>${cleanBody}</p>
                </div>\n`;
            });

            // Remove header/footer nav lines from markdown (we have our own sidebar/footer nav)
            md = md.replace(/\[üìö Lab Guide\][^\n]+\n+---/g, '');
            md = md.replace(/\[üìö Lab Guide\][^\n]+/g, '');
            md = md.replace(/üëâ \*\*\[Continue to[^\n]+/g, '');
            md = md.replace(/üëâ \*\*\[Start with[^\n]+/g, '');

            // Convert internal .md links to step.html links
            md = md.replace(/\]\((\d+)-([^)]+)\.md\)/g, '](step.html?step=$1-$2)');
            md = md.replace(/\]\(GUIDE\.md\)/g, '](step.html?step=guide)');

            // Convert links to parent README
            md = md.replace(/\]\(\.\.\/README\.md\)/g, '](index.html)');

            // Clean up multiple consecutive horizontal rules
            md = md.replace(/---\s*\n\s*---/g, '---');

            return md;
        }

        async function loadStep(index) {
            const step = steps[index];
            if (!step) return;

            currentStepIndex = index;
            window.history.replaceState(null, '', `?step=${step.id}`);

            document.getElementById('loading').style.display = 'flex';
            document.getElementById('content').style.display = 'none';

            buildSidebar();
            updateNavButtons();

            try {
                const url = GITHUB_RAW_BASE + step.file;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                let md = await response.text();
                md = processMarkdown(md);
                document.getElementById('markdown-content').innerHTML = marked.parse(md);
            } catch (err) {
                document.getElementById('markdown-content').innerHTML = `
                    <div class="alert alert-warning">
                        <div class="alert-title">‚ö†Ô∏è Could not load content</div>
                        <p>Failed to load <code>${step.file}</code>. Please check your connection or try again later.</p>
                    </div>`;
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            buildFooterNav();
            window.scrollTo(0, 0);
        }

        function goToStep(index) {
            if (index >= 0 && index < steps.length) {
                loadStep(index);
            }
        }

        function navigateStep(direction) {
            goToStep(currentStepIndex + direction);
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            if (e.key === 'ArrowLeft') navigateStep(-1);
            if (e.key === 'ArrowRight') navigateStep(1);
        });

        // Konami code easter egg
        const konamiCode = [38,38,40,40,37,39,37,39,66,65];
        let konamiIndex = 0;
        document.addEventListener('keydown', (e) => {
            if (e.keyCode === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    konamiIndex = 0;
                    if (typeof confetti === 'function') {
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                        setTimeout(() => confetti({ particleCount: 100, angle: 60, spread: 55, origin: { x: 0 } }), 250);
                        setTimeout(() => confetti({ particleCount: 100, angle: 120, spread: 55, origin: { x: 1 } }), 400);
                    }
                }
            } else {
                konamiIndex = 0;
            }
        });

        // Initialize
        const stepId = getStepFromURL();
        const initialIndex = steps.findIndex(s => s.id === stepId);
        loadStep(initialIndex >= 0 ? initialIndex : 0);
    </script>
</body>
</html>
